@using Microsoft.AspNet.Identity
@using Portalia.Models
@using Portalia.Core.Enum
@using System.Configuration
@using System.Security.Claims
@using Portalia.Extentions

@{
    var currentUrl = Request.Url?.GetLeftPart(UriPartial.Authority);
    string currentUserId = User.Identity.GetUserId();
    string listOfBrowserInfors = ConfigurationManager.AppSettings["BrowsersSupport"];
}
<!DOCTYPE html>
<html lang="fr" class="fontawesome-i2svg-active fontawesome-i2svg-complete">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117105734-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-117105734-1');
    </script>
    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-W7KCQ67');
    </script>
    <!-- End Google Tag Manager -->
    <meta name="http-equiv" content="Content-type: text/html; charset=ISO-88591" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Portalia,Portalia, l'indépendance salariale par le portage" />
    <meta name="author" content="Portalia">
    <meta name="keywords" content="portage, indépendance, salarié, contrat, consultant, emploi, rapide, mission" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Société de portage salarial française | Portalia.fr</title>
    @Scripts.Render("~/bundles/modernizr")
    @Styles.Render("~/Content/dropzonescss")
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="assets/js/html5shiv.js"></script>
        <script src="assets/js/respond.min.js"></script>
    <![endif]-->
    <link href="~/Content/css/bootstrap-editable.css" rel="stylesheet" />
    <link href="~/Content/css/select2.css" rel="stylesheet" />
    @Styles.Render("~/bundles/css")
    <link href="~/Content/bootstrap-datepicker3.css" rel="stylesheet" />
    <link href="~/Content/css/datatables.min.css" rel="stylesheet" />
    @RenderSection("styles", required: false)
    <script type="text/javascript">window.$crisp = []; window.CRISP_WEBSITE_ID = "e812e6c3-2ad0-411b-8b20-1bae049a2380"; (function () { d = document; s = d.createElement("script"); s.src = "https://client.crisp.chat/l.js"; s.async = 1; d.getElementsByTagName("head")[0].appendChild(s); })();</script>
    <script src="~/Scripts/all.js"></script>
    <link href="~/Content/css.css" rel="stylesheet" />
    <link href="~/Content/css-mobile.css" rel="stylesheet" />
    <script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="560609c7-4c85-40be-8e70-86affcad77ed" type="text/javascript" async></script>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W7KCQ67"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header class="header">
        <div class="header-container">
            <div class="header__wrapper">
                <div class="header__logo-container">
                    <nav class="navbar navbar-light navbar-expand-lg">
                        <a class="navbar-brand" href="@currentUrl">
                            <img class="portal-header__logo-img" src="https://cdn.o2f-it.com/download/20043/logo-portalia.gif" alt="logo" />
                        </a>
                        @*<div class="navbar-header navbar-right">
                                <button type="button" class="navbar-toggle collapsed btn-mobile" data-toggle="collapse" data-target="#navbarContent" aria-expanded="false">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>*@

                        <div class="header__menu-container navbar-collapse collapse" id="navbarContent">
                            <ul class="nav navbar-nav  ">
                                <li class="btn-menu my-personal-space @(@Convert.ToString(Request.RawUrl) == @Url.Action("MySpace", "Proposal") ? "btn-menu--active" : "")">
                                    <a href="@Url.Action("MySpace", "Proposal")" class="btn-menu__header">Mon activité</a>
                                </li>

                                <li class="btn-menu ">
                                    <a class="btn-menu__header dropdown-toggle" id="dropdownMenuBtn" data-toggle="dropdown" aria-expanded="false" aria-haspopup="true">
                                        Outils RH
                                        <i class="fas fa-angle-down"></i>
                                    </a>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuBtn">
                                        <li class="dropdown-item">
                                            <a class="btn-menu dropdown-list" target="_blank" rel="noopener" href="https://arp.portalia.fr/dNA/employee/">@Portalia.Resources.HomePage.DNA</a>
                                        </li>
                                        <li class="dropdown-item">
                                            <a class="btn-menu dropdown-list" target="_blank" rel="noopener" href="https://arp.portalia.fr/timesheet">@Portalia.Resources.HomePage.CRA</a>
                                        </li>
                                        <li class="dropdown-item">
                                            <a class="btn-menu dropdown-list" target="_blank" rel="noopener" href="https://arp.portalia.fr/expenses">@Portalia.Resources.HomePage.NotesDeFrais</a>
                                        </li>
                                    </ul>
                                </li>

                                <li class="btn-menu @(@Convert.ToString(Request.RawUrl) == "/trouvez-mission-portage-salarial" ? "btn-menu--active" : "")">
                                    <a href="/trouvez-mission-portage-salarial" class="btn-menu__header">Trouvez une mission</a>
                                </li>

                                <li class="btn-menu @(@Convert.ToString(Request.RawUrl) == @Url.Action("Tutorials", "Document") ? "btn-menu--active" : "")">
                                    <a href="@Url.Action("Tutorials", "Document")" class="btn-menu__header">Tutoriels</a>
                                </li>

                                @* Display if user type is Administrator *@
                                @if (Request.IsAuthenticated && User.IsInRole("Administrator"))
                                {
                                    <li class="btn-menu @(@Convert.ToString(Request.RawUrl) == @Url.Action("Index", "Administrator") ? "btn-menu--active" : "")">
                                        <a class="btn-menu__header" href="@Url.Action("Index", "Administrator")">@Portalia.Resources.HomePage.Administrator</a>
                                    </li>
                                }
                            </ul>
                        </div>
                        <div class="block-btn">
                            <div class="header__profile dropdown">
                                @if (Request.IsAuthenticated)
                                {
                                    var pictureUrl = Html.Action("GetUserPicture", "Account").ToString();
                                    if (pictureUrl.IndexOf("http") < 0)
                                    {
                                        pictureUrl = $"{Request.Url.Scheme}{System.Uri.SchemeDelimiter}{Request.Url.Authority}/{pictureUrl}";
                                    }
                                    <a href="#" class="dg dropdown-toggle" data-toggle="dropdown">
                                        <span class="header__profile-img" style="background-image: url(@pictureUrl)"></span>
                                        <strong class="full-name">@User.Identity.GetFullname()</strong>
                                        <i class="fas fa-angle-down"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-right">
                                        <li class="header__profile__welcome-msg">
                                            <span> Bonjour @User.Identity.GetFirstname() </span>
                                        </li>
                                        <li class="header__profile__link @(@Convert.ToString(Request.RawUrl) == @Url.Action("Index", "Manage") ? "header__profile__link--active" : "")">
                                            <a href="@Url.Action("Index", "Manage")" title="Manage">@Portalia.Resources.HomePage.MyUserProfile <span id="total-mission-fields" class="badge">@Html.Action("CountMissingField", "Proposal")</span></a>
                                        </li>
                                        @if (User.GetCanChangePasswordClaim())
                                        {
                                            <li class="header__profile__link @(@Convert.ToString(Request.RawUrl) == @Url.Action("ChangePassword", "Manage") ? "header__profile__link--active" : "")">
                                                <a href="@Url.Action("ChangePassword", "Manage")">Mes paramètres</a>
                                            </li>
                                        }
                                        else if (User.GetIsAdfsUserClaim())
                                        {
                                            <li class="header__profile__link">
                                                <a href="https://login.o2f-it.com/adfs/portal/updatepassword?userName=@(User.GetEmail())">Changer mon mot de passe</a>
                                            </li>
                                        }
                                        <li class="header__profile__link @(@Convert.ToString(Request.RawUrl) == "/a-propos" ? "header__profile__link--active" : "") ">
                                            <a href="/a-propos">À propos de Portalia</a>
                                        </li>

                                        <li class="divider navbar-login-session-bg"></li>
                                        <li class="header__profile__link header__profile__logout">
                                            <a class="#" href="javascript:document.getElementById('logoutForm').submit()">@Portalia.Resources.Login.SignOut</a>
                                        </li>
                                    </ul>
                                    using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm" }))
                                    {
                                        @Html.AntiForgeryToken()
                                    }
                                }
                            </div>

                            <button type="button" class="navbar-toggle collapsed btn-mobile" data-toggle="collapse" data-target="#navbarContent" aria-expanded="false">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>

                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    @RenderBody()

    @if (Request.IsAuthenticated)
    {
        Html.RenderAction("WorkContractButton", "Layout");
    }

    @Html.Partial("~/Views/Shared/_WelcomeCard.cshtml")

    <a href="javascript:void(0);" id="back-top"><i class="fas fa-arrow-up"></i></a>
    <a href="mailto:procher@portalia.fr?subject=New message from Portalia website --> TBC" id="mail-to">
        <svg id="mail-to-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 30 30">
            <polygon id="mail-to-polygon" points="1,29 1,1 29,1 29,20 9,20" />
        </svg>
    </a>
    <!--FOOTER-->

    @Html.Partial("~/Views/Shared/_Footer.cshtml")

    <!---INSCRIPTION -->
    <!-- Modal -->
    <div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="myModal">
        <div class="modal-dialog" role="document" style="width: 650px;">
            <div class="modal-content" id="myModalContent">
                ...
            </div>
        </div>
    </div>

    <!--ajax loading icon-->
    <div class="ajax-loading ajax-loading-hidden" id="ajax-loading">
        @*<i class="ajax-loading-icon fas fa-circle-notch fa-spin fa-7x"></i>*@
        <div class="lds-dual-ring"></div>
    </div>
    <!--notification-->
    <div id="alert-success" class="alert alert-success" style="display: none">
    </div>

    <div id="alert-fail" class="alert alert-danger" style="display: none">
    </div>
    <!-- JavaScript libs are placed at the end of the document so the pages load faster -->
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/bootstrap")
    <script src="~/Scripts/bootstrap-editable.min.js"></script>
    <script src="~/Scripts/dropzone/dropzone.js"></script>
    @Scripts.Render("~/bundles/helper")
    @Scripts.Render("~/bundles/home")
    <script src="~/Scripts/bootstrap-datepicker.js"></script>
    <script src="~/Scripts/datatables.min.js"></script>
    @Scripts.Render("~/bundles/common")
    @RenderSection("scripts", required: false)

    @Scripts.Render("~/bundles/WelcomeCard") <!--updated-->
    <script>
        $(document).ready(function () {
            $.ajaxSetup({ cache: false });
            $('.city').hover(function () {
                var iconId = $(this).text();
                $('#' + iconId).attr("class", "city-icon transition");
            },
                function () {
                    var iconId = $(this).text();
                    $('#' + iconId).attr("class", "city-icon");

                });
            if ($(window).width() <= 991) {
                $('#dropdownMenuBtn, #dropdownMenuBtn-Login').off('click');
                $('#dropdownMenuBtn, #dropdownMenuBtn-Login').next().addClass('show');
            }
            $('.btn-mobile').on('click', function (e) {
                if ($('body').hasClass('bodyover')) {
                    $('body').removeClass('bodyover')
                } else {
                    $('body').addClass('bodyover')
                }
            })

            /*
             * Show hide Proposal - Document Tab
             */
            var myPersonalSpace = document.querySelector('.my-personal-space');
            myPersonalSpace.addEventListener("click", function (e) {
                var documentTab = document.querySelector('.document-tab.sub-menu');
                var url = window.location.pathname;
                var width = window.innerWidth;

                //const urlProposal = `${window.location.href.indexOf('localhost') !== -1 ? '/Proposal/MySpace' : '/Portalia/Proposal/MySpace'}`;
                const urlProposal = window.location.href.indexOf('localhost') !== -1 ? '/Proposal/MySpace' : '/Portalia/Proposal/MySpace';

                if (url == urlProposal && width > 992) {
                    e.preventDefault();
                    if (documentTab.classList.contains('sub-menu--hide')) {
                        documentTab.classList.remove("sub-menu--hide");
                    } else {
                        documentTab.classList.add("sub-menu--hide");
                    }
                }
            });

            common.initializeEventsForWorkContractButton();
        });
    </script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] ||
                function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-96157591-1', 'auto');
        ga('send', 'pageview');
    </script>
    @if (!SessionManager.HasCheckedBrowser && SessionManager.IsShowBrowserWarning && !string.IsNullOrEmpty(listOfBrowserInfors))
    {
        <script>
            var urlTurnOff = "/Comp/TurnOffBrowserWarning";
            var listOfBrowserInfors = "@listOfBrowserInfors";

            $(document).ready(function () {

                var isShowWarning = ShowWarningIfBrowserIsOutDate(listOfBrowserInfors);
                var isShowBrowser, hasCheckedBrowser;

                isShowBrowser = false;
                hasCheckedBrowser = true;

                $.ajax({
                    type: "POST",
                    url: urlTurnOff,
                    data: {
                        isShowBrowser: isShowBrowser,
                        hasCheckedBrowser: hasCheckedBrowser
                    },
                    success: function (response) {
                        if (isShowWarning) {
                            alert("Oups ! Il semble que vous utilisiez un navigateur qui n'est plus supporté par nos services. Nous vous recommandons d'utiliser la dernière version de Google Chrome, Mozilla Firefox, Microsoft Edge ou Safari pour une expérience optimale.");
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {

                    }
                });
            })
        </script>
    }
    <script src="~/Scripts/js.js"></script>

</body>
</html>